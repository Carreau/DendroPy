#! /usr/bin/env python

##############################################################################
##  DendroPy Phylogenetic Computing Library.
##
##  Copyright 2010-2015 Jeet Sukumaran and Mark T. Holder.
##  All rights reserved.
##
##  See "LICENSE.rst" for terms and conditions of usage.
##
##  If you use this work or any portion thereof in published work,
##  please cite it as:
##
##     Sukumaran, J. and M. T. Holder. 2010. DendroPy: a Python library
##     for phylogenetic computing. Bioinformatics 26: 1569-1571.
##
##############################################################################

"""
Tests of protracted speciation model/process.
"""

import unittest
import dendropy
from dendropy.model import protractedspeciation

class ProtractedSpeciationCalcs(unittest.TestCase):

    def test_expected_duration_of_speciation(self):
        refs = [
            ((0.01, 0.01, 0.0), 69.31471805599453),
            ((0.01, 0.01, 0.005), 60.96406423356387),
            ((0.01, 0.01, 0.01), 52.344553381571906),
            ((0.01, 0.05, 0.0), 18.232155679395458),
            ((0.01, 0.05, 0.005), 17.03243269197848),
            ((0.01, 0.05, 0.01), 15.945243534199998),
            ((0.01, 0.1, 0.0), 9.531017980432493),
            ((0.01, 0.1, 0.005), 9.151173562881866),
            ((0.01, 0.1, 0.01), 8.796646443907925),
            ((0.01, 0.5, 0.0), 1.980262729617973),
            ((0.01, 0.5, 0.005), 1.9614061471032902),
            ((0.01, 0.5, 0.01), 1.9428949825831419),
            ((0.01, 1.0, 0.0), 0.9950330853168092),
            ((0.01, 1.0, 0.005), 0.9901794650170307),
            ((0.01, 1.0, 0.01), 0.9853722709707085),
            ((0.05, 0.01, 0.0), 35.8351893845611),
            ((0.05, 0.01, 0.025), 34.610696533124994),
            ((0.05, 0.01, 0.05), 27.67607317551539),
            ((0.05, 0.05, 0.0), 13.862943611198906),
            ((0.05, 0.05, 0.025), 12.192812846712773),
            ((0.05, 0.05, 0.05), 10.46891067631438),
            ((0.05, 0.1, 0.0), 8.109302162163289),
            ((0.05, 0.1, 0.025), 7.261356156801292),
            ((0.05, 0.1, 0.05), 6.4859100952301745),
            ((0.05, 0.5, 0.0), 1.9062035960864987),
            ((0.05, 0.5, 0.025), 1.830234712576371),
            ((0.05, 0.5, 0.05), 1.7593292887815883),
            ((0.05, 1.0, 0.0), 0.9758032833886409),
            ((0.05, 1.0, 0.025), 0.9541399331844385),
            ((0.05, 1.0, 0.05), 0.9333523826096167),
            ((0.1, 0.01, 0.0), 23.978952727983707),
            ((0.1, 0.01, 0.05), 25.39055478519575),
            ((0.1, 0.01, 0.1), 20.28571191298721),
            ((0.1, 0.05, 0.0), 10.986122886681098),
            ((0.1, 0.05, 0.05), 9.802581434685468),
            ((0.1, 0.05, 0.1), 8.109302162163289),
            ((0.1, 0.1, 0.0), 6.931471805599453),
            ((0.1, 0.1, 0.05), 6.096406423356386),
            ((0.1, 0.1, 0.1), 5.23445533815719),
            ((0.1, 0.5, 0.0), 1.8232155679395459),
            ((0.1, 0.5, 0.05), 1.7032432691978485),
            ((0.1, 0.5, 0.1), 1.5945243534199998),
            ((0.1, 1.0, 0.0), 0.9531017980432493),
            ((0.1, 1.0, 0.05), 0.9151173562881855),
            ((0.1, 1.0, 0.1), 0.8796646443907942),
            ((0.5, 0.01, 0.0), 7.8636512654486515),
            ((0.5, 0.01, 0.25), 10.29910408256293),
            ((0.5, 0.01, 0.5), 9.485738357710689),
            ((0.5, 0.05, 0.0), 4.795790545596741),
            ((0.5, 0.05, 0.25), 5.07811095703915),
            ((0.5, 0.05, 0.5), 4.057142382597441),
            ((0.5, 0.1, 0.0), 3.58351893845611),
            ((0.5, 0.1, 0.25), 3.4610696533125007),
            ((0.5, 0.1, 0.5), 2.7676073175515397),
            ((0.5, 0.5, 0.0), 1.3862943611198906),
            ((0.5, 0.5, 0.25), 1.219281284671277),
            ((0.5, 0.5, 0.5), 1.046891067631438),
            ((0.5, 1.0, 0.0), 0.8109302162163288),
            ((0.5, 1.0, 0.25), 0.7261356156801294),
            ((0.5, 1.0, 0.5), 0.6485910095230177),
            ((1.0, 0.01, 0.0), 4.61512051684126),
            ((1.0, 0.01, 0.5), 6.465141234074228),
            ((1.0, 0.01, 1.0), 6.774422698356164),
            ((1.0, 0.05, 0.0), 3.044522437723423),
            ((1.0, 0.05, 0.5), 3.556910942852685),
            ((1.0, 0.05, 1.0), 2.9389333245105935),
            ((1.0, 0.1, 0.0), 2.3978952727983707),
            ((1.0, 0.1, 0.5), 2.539055478519575),
            ((1.0, 0.1, 1.0), 2.0285711912987203),
            ((1.0, 0.5, 0.0), 1.0986122886681098),
            ((1.0, 0.5, 0.5), 0.9802581434685471),
            ((1.0, 0.5, 1.0), 0.8109302162163288),
            ((1.0, 1.0, 0.0), 0.6931471805599453),
            ((1.0, 1.0, 0.5), 0.6096406423356385),
            ((1.0, 1.0, 1.0), 0.523445533815719),
        ]
        for params, exp_result in refs:
            obs_result = protractedspeciation.expected_duration_of_speciation(
                    speciation_initiation_rate=params[0],
                    speciation_completion_rate=params[1],
                    incipient_species_extinction_rate=params[2],
                    )
            self.assertAlmostEqual(obs_result, exp_result)


if __name__ == "__main__":
    unittest.main()


